import "hash"

rule BLL_Sneaky_WSL
{
   meta:
      author = "@ManuelBerrueta"
      date = "20210918"
      description = "Yara rule for detecting the presence of WSL Malware found by @BlackLotusLabs"
      version = "1.0"
      reference_1 = "https://blog.lumen.com/no-longer-just-theory-black-lotus-labs-uncovers-linux-executables-deployed-as-stealth-windows-loaders/"
      reference_2 = "https://github.com/blacklotuslabs/IOCs/blob/main/WSL%20samples.txt"
      filetype = "ELF && Python"

   strings:
      $hello_sanya_str = "Пивет Саня" wide ascii
      $ip_address = "185.63.90.137"
      $payload_url = "http://185.63.90.137:1338//stagers/l5l.py"

   condition:
      $hello_sanya_str or
      $ip_address or
      $payload_url or
      hash.sha256(0, filesize) == "53854c6d163bfd0c56d8b297ac43bd25c21f696de6063031241e792ee65df441" or
      hash.sha256(0, filesize) == "c297e545b8f150cc5ff56dbb68dc74fe30a421d9d40f38f4a53083192697c44c" or
      hash.sha256(0, filesize) == "17921368901f23e0cad0d2fe4ce5694aebaf4727699ed0358117500701914d1b" or
      hash.sha256(0, filesize) == "198a2d42df010d838b4207f478d885ef36e3db13b1744d673e221b828c28bf77" or
      hash.sha256(0, filesize) == "71d7b48c2fdc7b57b104a7858a35165bbed21d2fa7e34828d6c1d50b2b33a1d0" or
      hash.sha256(0, filesize) == "601227d52c6e367e11b80240183d07d38bc11a88e844e8401fce17eb25e92ba8" or
      hash.sha256(0, filesize) == "63ff04bed4fdb120a9cb9b1ea7fd88e83f12fb01ab6a057088f8016e663b48d4" or
      hash.sha256(0, filesize) == "a3037c3389b811bc1404f719af5c8b9034c5e24710cf3a0b457d28bf1b922cf7" or
      hash.sha256(0, filesize) == "e19b8be1b21c066d60725e550f8455f824065abbf1b43f7b2fe4fb338b241ffc" or
      hash.sha256(0, filesize) == "a3037c3389b811bc1404f719af5c8b9034c5e24710cf3a0b457d28bf1b922cf7"
}